<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS-Link</title>
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="logo-text">JS-Link</div>
        <div class="top-bar-requests" id="top-bar-requests">
            <!-- Opened request panels will be shown here -->
        </div>
        <div class="top-bar-actions">
            <button class="toggle-switch" id="layout-toggle-btn" title="Toggle Horizontal/Vertical Layout">
                <i class="fas fa-columns"></i>
                <span>Layout</span>
            </button>
            <button class="toggle-switch" id="environment-toggle-btn" title="Toggle Environment Panel">
                <i class="fas fa-cog"></i>
                <span>Env</span>
            </button>
            <button class="toggle-switch" id="theme-toggle-btn">
                <i class="fas fa-sun"></i>
                <span>Mode</span>
            </button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Left Sidebar -->
        <div class="left-sidebar">
            <!-- Collection Section -->
            <div class="sidebar-section-collapsible" id="collection-section">
                <div class="sidebar-section-header" id="collection-header">
                    <div class="sidebar-section-title">
                        <i class="fas fa-chevron-down section-chevron"></i>
                        <span>Collection</span>
                    </div>
                    <div class="sidebar-section-actions">
                        <button type="button" class="icon-btn" id="new-folder-btn" title="New Folder"
                            style="background: transparent; border: none; color: rgba(255, 255, 255, 0.6); cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s;">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button type="button" class="icon-btn" id="new-request-sidebar-btn" title="New Request"
                            style="background: transparent; border: none; color: rgba(255, 255, 255, 0.6); cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s;">
                            <i class="fas fa-plus-square"></i>
                        </button>
                    </div>
                </div>
                <div class="sidebar-section-content" id="collection-content">
                    <ul class="collection-tree" id="collection-tree">
                        <!-- Collections will be loaded here -->
                    </ul>
                </div>
            </div>

            <!-- History Section -->
            <div class="sidebar-section-collapsible" id="history-section">
                <div class="sidebar-section-header" id="history-header">
                    <div class="sidebar-section-title">
                        <i class="fas fa-chevron-down section-chevron"></i>
                        <span>History</span>
                    </div>
                </div>
                <div class="sidebar-section-content" id="history-content">
                    <ul class="history-tree" id="history-tree">
                        <!-- History will be loaded here -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Request Tabs -->
            <div class="request-tabs-bar">
                <button class="new-request-btn" id="new-request-btn">
                    <i class="fas fa-plus"></i> New Request
                </button>
                <div id="request-tabs-container">
                    <!-- Request tabs will be added here -->
                </div>
            </div>

            <!-- Panels Container (for layout switching) -->
            <div class="panels-container" id="panels-container">
                <!-- Request Editor -->
                <div class="request-editor-panel">
                <div class="panel-header">
                    <h3>Request Editor</h3>
                </div>
                <div class="request-url-bar">
                    <select class="type-select" id="request-type">
                        <option value="api">API</option>
                        <option value="ws">WebSocket</option>
                    </select>
                    <select class="method-select" id="request-method">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                        <option value="PUT">PUT</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PATCH">PATCH</option>
                        <option value="HEAD">HEAD</option>
                        <option value="OPTIONS">OPTIONS</option>
                    </select>
                    <input type="text" class="url-input" id="request-url" placeholder="Enter request URL"
                        value="https://api.example.com/v1/users">
                    <button class="send-btn" id="send-request-btn">
                        <i class="fas fa-play"></i> Send
                    </button>
                    <button class="send-btn ws-connect-btn hidden" id="ws-connect-btn"
                        style="background: var(--green);">
                        <i class="fas fa-plug"></i> Connect
                    </button>
                    <button class="send-btn ws-disconnect-btn hidden" id="ws-disconnect-btn"
                        style="background: var(--danger);">
                        <i class="fas fa-times"></i> Disconnect
                    </button>
                </div>

                <div class="request-sub-tabs">
                    <button class="request-sub-tab active" data-tab="headers">Headers</button>
                    <button class="request-sub-tab" data-tab="body">Body</button>
                    <button class="request-sub-tab" data-tab="auth">Auth</button>
                    <button class="request-sub-tab ws-tab hidden" data-tab="websocket">WebSocket</button>
                </div>

                <div class="request-content">
                    <div id="headers-tab" class="tab-pane active">
                        <table class="headers-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;"></th>
                                    <th>Key</th>
                                    <th>Value</th>
                                    <th style="width: 40px;"></th>
                                </tr>
                            </thead>
                            <tbody id="headers-tbody">
                                <tr class="header-row">
                                    <td>
                                        <input type="checkbox" class="header-checkbox" checked>
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" value="Authorization" placeholder="Key">
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" value="Bearer {{token}}"
                                            placeholder="Value">
                                    </td>
                                    <td>
                                        <button class="header-remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="header-row">
                                    <td>
                                        <input type="checkbox" class="header-checkbox" checked>
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" value="Content-Type" placeholder="Key">
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" value="application/json"
                                            placeholder="Value">
                                    </td>
                                    <td>
                                        <button class="header-remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="header-row" id="new-header-row">
                                    <td>
                                        <input type="checkbox" class="header-checkbox">
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" placeholder="Key">
                                    </td>
                                    <td>
                                        <input type="text" class="header-input" placeholder="Value">
                                    </td>
                                    <td>
                                        <button class="header-remove" style="display: none;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="body-tab" class="tab-pane">
                        <div class="body-type-selector" style="margin-bottom: 12px;">
                            <label class="body-type-label">Body Type:</label>
                            <select id="body-type-select" class="body-type-select">
                                <option value="none">None</option>
                                <option value="json" selected>JSON</option>
                                <option value="xml">XML</option>
                                <option value="text">Text</option>
                                <option value="form">Form URL Encoded</option>
                                <option value="multipart">Multipart Form</option>
                                <option value="binary">Binary</option>
                            </select>
                            <button type="button" class="btn-format-body" id="format-body-btn" title="Format JSON (4 spaces)">
                                <i class="fas fa-indent"></i> Format
                            </button>
                        </div>
                        <textarea id="request-body"
                            style="width: 100%; min-height: 300px; padding: 12px; border: 1px solid var(--border-color); border-radius: 4px; font-family: 'Fira Code', 'Courier New', monospace; font-size: 13px; tab-size: 4;"
                            placeholder="Request body (JSON, XML, etc.)"></textarea>
                    </div>

                    <div id="auth-tab" class="tab-pane">
                        <div class="auth-container" style="padding: 20px;">
                            <div class="auth-type-selector" style="margin-bottom: 20px;">
                                <label class="auth-type-label" style="display: block; margin-bottom: 8px; font-weight: 500;">Auth Type:</label>
                                <select id="auth-type-select" class="auth-type-select" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background); color: var(--text-primary);">
                                    <option value="none" selected>None</option>
                                    <option value="bearer">Bearer Token</option>
                                    <option value="basic">Basic Auth</option>
                                </select>
                            </div>
                            <div id="auth-none-section" class="auth-section">
                                <p style="color: var(--text-secondary);">No authentication required.</p>
                            </div>
                            <div id="auth-bearer-section" class="auth-section hidden">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">Token:</label>
                                    <input type="text" id="auth-bearer-token" class="form-input" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background); color: var(--text-primary);"
                                        placeholder="Enter bearer token or use {{variable}}">
                                </div>
                            </div>
                            <div id="auth-basic-section" class="auth-section hidden">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">Username:</label>
                                    <input type="text" id="auth-basic-username" class="form-input" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background); color: var(--text-primary);"
                                        placeholder="Enter username">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">Password:</label>
                                    <input type="password" id="auth-basic-password" class="form-input" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background); color: var(--text-primary);"
                                        placeholder="Enter password">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="websocket-tab" class="tab-pane">
                        <div class="ws-container">
                            <div class="ws-status" id="ws-status">
                                <span class="ws-status-indicator disconnected"></span>
                                <span id="ws-status-text">Disconnected</span>
                            </div>
                            <div class="ws-send-section">
                                <textarea id="ws-message-input" placeholder="Enter message to send..."
                                    rows="3"></textarea>
                                <button class="btn btn-primary" id="ws-send-btn" disabled>
                                    <i class="fas fa-paper-plane"></i> Send Message
                                </button>
                            </div>
                            <div class="ws-messages-section">
                                <div class="ws-messages-header">
                                    <h4>Messages</h4>
                                    <button class="btn btn-outline" id="ws-clear-btn"
                                        style="padding: 4px 8px; font-size: 12px;">
                                        <i class="fas fa-trash"></i> Clear
                                    </button>
                                </div>
                                <div class="ws-messages" id="ws-messages">
                                    <!-- WebSocket messages will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Resizer Handle -->
                <div class="panel-resizer" id="panel-resizer">
                    <div class="resizer-handle"></div>
                </div>

                <!-- Response Panel -->
                <div class="response-panel">
                <div class="panel-header">
                    <h3>Response Panel</h3>
                </div>
                <div class="response-header">
                    <div class="response-status">
                        <span class="status-badge" id="response-status">200 OK</span>
                        <div class="response-metrics">
                            <span id="response-time">145ms</span>
                            <span id="response-size">1.2KB</span>
                        </div>
                    </div>
                    <div class="response-actions">
                        <button class="response-action-btn" id="copy-response">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="response-action-btn" id="save-response">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="response-action-btn" id="format-response">
                            <i class="fas fa-code"></i> Format
                        </button>
                        <button class="response-action-btn hidden" id="preview-response">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                </div>

                <div class="response-tabs">
                    <button class="response-tab active" data-tab="response-body">Body</button>
                    <button class="response-tab" data-tab="response-headers">Headers</button>
                    <button class="response-tab hidden" data-tab="response-preview" id="response-preview-tab">Preview</button>
                    <button class="response-tab" data-tab="response-timeline">Timeline</button>
                </div>

                <div class="response-content">
                    <div id="response-body" class="response-tab-pane active">
                        <pre id="response-body-content">{
  "oid": 1000,
  "users": [
    {
      "name": "aionomans",
      "address": "2023-86-20T18:35:38.202",
      "emai": "bovsstw"
    }
  ]
}</pre>
                    </div>
                    <div id="response-headers" class="response-tab-pane">
                        <pre style="color: var(--text-secondary); padding: 20px;">No headers received</pre>
                    </div>
                    <div id="response-preview" class="response-tab-pane">
                        <iframe id="html-preview-frame" style="width: 100%; height: 100%; min-height: 400px; border: none; background: white;"></iframe>
                    </div>
                    <div id="response-timeline" class="response-tab-pane">
                        <pre style="color: var(--text-secondary); padding: 20px;">Send a request to see timeline</pre>
                    </div>
                </div>
            </div>
            </div>
            <!-- End Panels Container -->

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Connected</span>
                </div>
                <span>Memory: 245MB</span>
                <span>Active Requests: <span id="active-requests">1</span></span>
                <span>Avg Response: <span id="avg-response">120ms</span></span>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <div class="sidebar-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3>Environment Selector</h3>
                    <button id="add-environment-btn"
                        style="background: transparent; border: none; color: var(--text-light); cursor: pointer; padding: 4px 8px; border-radius: 4px;"
                        title="Add Environment">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <div class="environment-selector">
                    <select id="environment-select">
                        <option value="">Select Environment</option>
                    </select>
                </div>
                <div class="environment-actions" id="environment-actions" style="display: none; margin-top: 8px; gap: 8px; justify-content: space-between;">
                    <button id="edit-environment-btn" class="btn btn-outline" style="flex: 1; padding: 6px 10px; font-size: 12px;" title="Edit Environment">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button id="archive-environment-btn" class="btn btn-outline" style="flex: 1; padding: 6px 10px; font-size: 12px;" title="Archive Environment">
                        <i class="fas fa-archive"></i> Archive
                    </button>
                    <button id="delete-environment-btn" class="btn btn-outline" style="flex: 1; padding: 6px 10px; font-size: 12px; color: var(--danger);" title="Delete Environment">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Variable Preview</h3>
                <ul class="variable-list" id="variable-preview">
                    <!-- Variables will be loaded here -->
                </ul>
            </div>

            <div class="sidebar-section">
                <h3>Execution History</h3>
                <ul class="history-list" id="execution-history">
                    <!-- History will be loaded here -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- New Request Choice Modal -->
    <div class="modal-overlay" id="new-request-choice-modal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Select Request Type</h3>
                <button class="modal-close" onclick="closeModal('new-request-choice-modal')">&times;</button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn btn-primary" onclick="openRequestModal(null, 'http'); closeModal('new-request-choice-modal');">
                    <i class="fas fa-file-code"></i> New HTTP/API Request
                </button>
                <button class="btn btn-outline" onclick="openRequestModal(null, 'ws'); closeModal('new-request-choice-modal');">
                    <i class="fas fa-exchange-alt"></i> New WebSocket Request
                </button>
            </div>
        </div>
    </div>

    <!-- Folder Modal -->
    <div class="modal-overlay" id="folder-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="folder-modal-title">New Folder</h3>
                <button class="modal-close" onclick="closeModal('folder-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="folder-form">
                    <input type="hidden" id="folder-id" value="">
                    <div class="form-group">
                        <label class="form-label" for="folder-name">Folder Name</label>
                        <input type="text" class="form-input" id="folder-name" required placeholder="Enter folder name">
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeModal('folder-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveFolder()">Save</button>
            </div>
        </div>
    </div>

    <!-- Request Modal -->
    <div class="modal-overlay" id="request-modal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title" id="request-modal-title">New Request</h3>
                <button class="modal-close" onclick="closeModal('request-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="request-form">
                    <input type="hidden" id="request-id" value="">
                    <div class="form-group">
                        <label class="form-label" for="request-name">Request Name</label>
                        <input type="text" class="form-input" id="request-name" required
                            placeholder="Enter request name">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="request-method-modal">HTTP Method</label>
                        <select class="form-select" id="request-method-modal">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                            <option value="HEAD">HEAD</option>
                            <option value="OPTIONS">OPTIONS</option>
                            <option value="WS">WS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="request-url-modal">URL</label>
                        <input type="text" class="form-input" id="request-url-modal" required
                            placeholder="https://api.example.com/v1/users">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="request-folder-modal">Folder (Optional)</label>
                        <select class="form-select" id="request-folder-modal">
                            <option value="">None</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeModal('request-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveRequestFromModal()">Save</button>
            </div>
        </div>
    </div>

    <!-- Environment Modal -->
    <div class="modal-overlay" id="environment-modal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="environment-modal-title">New Environment</h3>
                <button class="modal-close" onclick="closeModal('environment-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="environment-form">
                    <input type="hidden" id="environment-id" value="">
                    <div class="form-group">
                        <label class="form-label" for="environment-name">Environment Name</label>
                        <input type="text" class="form-input" id="environment-name" required
                            placeholder="e.g., Development, Production">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="environment-variables">Variables (JSON)</label>
                        <div class="textarea-with-sample">
                            <textarea class="form-textarea" id="environment-variables" placeholder=" "></textarea>
                            <div class="textarea-sample" id="env-variables-sample">{
    "base_url": "https://api.example.com",
    "token": "your-api-token",
    "api_key": "your-api-key"
}</div>
                        </div>
                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                            Enter variables as JSON object. Use <code>{{'{{'}}variable{{'}}'}}</code> in requests to reference values.
                        </small>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeModal('environment-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveEnvironment()">Save</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>
